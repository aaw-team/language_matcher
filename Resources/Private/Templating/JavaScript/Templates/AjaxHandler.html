<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:if condition="{ajaxUri}">
(function() {
    "use strict";

    if (document.cookie.match('languageChooserDisabled')) {
        return;
    }

    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function(){
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                if (typeof response === 'object' && response.showHint) {
                    var el = document.createElement('div');
                    el.addEventListener('click', function(e) {
                        if(e.target.dataset && e.target.dataset.languagechooserno) {
                            e.preventDefault();
                            el.parentNode.removeChild(el);
                            document.cookie = 'languageChooserDisabled' + "=1; path=/";
                        }
                    }, {once:true});
                    el.innerHTML = response.html;
                    document.body.appendChild(el);
                }
            }
        }
    };
    xhr.open('GET', '<f:format.raw>{ajaxUri}</f:format.raw>', true);
    xhr.send();
})();
</f:if>
</html>
